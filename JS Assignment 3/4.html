<!DOCTYPE html>
<html>
<head>
    <title>Problem 4 : Mini Expense Tracker</title>
</head>
<body onload="initDB()">

<h2>Mini Expense Tracker</h2>

<!-- Input Fields -->
Title:
<input type="text" id="title"><br><br>

Amount:
<input type="number" id="amount"><br><br>

Date:
<input type="date" id="date"><br><br>

<!-- Buttons -->
<button onclick="addExpense()">Add Expense</button>
<button onclick="viewExpenses()">View Expenses</button>

<h3>Expense List</h3>
<ul id="expenseList"></ul>

<script>

let db;

// Initialize Database
function initDB() {

    if (!window.openDatabase) {
        alert("Web SQL not supported in this browser.");
        return;
    }

    db = openDatabase("ExpenseDB", "1.0", "Expense Database", 5 * 1024 * 1024);

    db.transaction(function(tx) {

        tx.executeSql(
            "CREATE TABLE IF NOT EXISTS expenses (id INTEGER PRIMARY KEY AUTOINCREMENT, title TEXT, amount REAL, date TEXT)",
            [],
            function() {
                console.log("Table created successfully");
            },
            function(tx, error) {
                alert("Table creation error: " + error.message);
            }
        );

    });
}


// Add Expense
function addExpense() {

    let title = document.getElementById("title").value;
    let amount = document.getElementById("amount").value;
    let date = document.getElementById("date").value;

    if (title === "" || amount === "" || date === "") {
        alert("Please fill all fields.");
        return;
    }

    db.transaction(function(tx) {

        tx.executeSql(
            "INSERT INTO expenses (title, amount, date) VALUES (?, ?, ?)",
            [title, amount, date],
            function() {
                alert("Expense Added Successfully!");
                viewExpenses();
            },
            function(tx, error) {
                alert("Insert Error: " + error.message);
            }
        );

    }, function(error) {
        alert("Transaction Error: " + error.message);
    });

}


// View Expenses
function viewExpenses() {

    db.transaction(function(tx) {

        tx.executeSql(
            "SELECT * FROM expenses",
            [],
            function(tx, results) {

                let list = document.getElementById("expenseList");
                list.innerHTML = "";

                for (let i = 0; i < results.rows.length; i++) {

                    let row = results.rows.item(i);

                    let li = document.createElement("li");
                    li.innerHTML =
                        row.id + " | " +
                        row.title + " | â‚¹" +
                        row.amount + " | " +
                        row.date +
                        " <button onclick='deleteExpense(" + row.id + ")'>Delete</button>";

                    list.appendChild(li);
                }
            },
            function(tx, error) {
                alert("Select Error: " + error.message);
            }
        );

    });

}


// Delete Expense
function deleteExpense(id) {

    db.transaction(function(tx) {

        tx.executeSql(
            "DELETE FROM expenses WHERE id = ?",
            [id],
            function() {
                alert("Expense Deleted");
                viewExpenses();
            },
            function(tx, error) {
                alert("Delete Error: " + error.message);
            }
        );

    }, function(error) {
        alert("Transaction Error: " + error.message);
    });

}

</script>

</body>
</html>